"use strict";(self.webpackChunkemojifi=self.webpackChunkemojifi||[]).push([[712],{712:(e,t,a)=>{a.d(t,{kg:()=>y,Dn:()=>x,Ww:()=>h,Zt:()=>E,Y_:()=>u,Vo:()=>w,wz:()=>A,Kh:()=>N,fO:()=>T,EQ:()=>R,DS:()=>k,FH:()=>S,F:()=>v,Ip:()=>K,jV:()=>I,Y4:()=>b,bF:()=>f,TK:()=>_,jH:()=>m});var o=a(6220),s=a(815),n=a(9751);const r=(0,s.Wp)({apiKey:"AIzaSyBOTVOdSu20rXHX_VWHnV3XmS9ZcnfQuBQ",authDomain:"midjourneyai-71161.firebaseapp.com",projectId:"midjourneyai-71161",storageBucket:"midjourneyai-71161.appspot.com",messagingSenderId:"559017193613",appId:"1:559017193613:web:8f4159f592c0a63e4e32c4",measurementId:"G-FEN6H6F61Y"}),c=(0,o.aU)(r),i=(0,n.c7)(r);var l=a(4456),p=a(7385),d=a(4651),g=a.n(d);const m=async e=>{let{name:t,data:a,folder:o="INPUT",isUrl:s}=e,r="";const c="".concat(o,"/").concat(t),l=(0,n.KR)(i,c);let d=a;return s&&(d=await(0,p.hs)(a)),await(0,n.ls)(l,d,"data_url"),r=await(0,n.qk)(l),r},h=async e=>{let{url:t}=e;try{const e=t,a=(0,n.KR)(i,e);return await(0,n.XR)(a),!0}catch(a){console.log("Error deleteFile ",a)}},u=async()=>{try{let e;const t=(0,o.H9)(c,"configs","configs"),a=await(0,o.x7)(t);return a.exists()&&(e=a.data()),e}catch(e){console.error("Error getUser: ",e)}},w=async()=>{try{let e;const t=(0,o.H9)(c,"configs","listAIStyle"),a=await(0,o.x7)(t);return a.exists()&&(e=a.data()),e}catch(e){console.error("Error listAIStyle: ",e)}},y=async e=>{let{id:t,username:a,coins:s}=e;try{const e=(new Date).toISOString().slice(0,10).replace("-","").replace("-","");await(0,o.BN)((0,o.H9)(c,"users","".concat(t)),{id:"".concat(t),username:a,coins:s,numAds:1,numAdsGen:1,expDateAds:e,expDateAdsGen:e,language:"en",createdAt:new Date,updateAt:new Date}),await(0,o.BN)((0,o.H9)(c,"albums","".concat(t)),{albums:[]})}catch(n){console.error("Error createUser: ",n)}},f=async e=>{let{id:t,coins:a,transactionId:s}=e;try{await(0,o.mZ)((0,o.H9)(c,"users","".concat(t)),{coins:a,updateAtTrans:"COIN_".concat(new Date),transactionId:"".concat(s)})}catch(n){console.error("Error updateCoinsUser: ",n)}},_=async e=>{let{id:t,coins:a,language:s,numAds:n,numAdsGen:r,expDateAds:i,expDateAdsGen:l,updatedAt:p}=e;try{let e={};s&&(e={...e,language:s}),null!==a&&void 0!==a&&(e={...e,coins:a}),null!==n&&void 0!==n&&(e={...e,numAds:n}),null!==r&&void 0!==r&&(e={...e,numAdsGen:r}),null!==i&&void 0!==i&&(e={...e,expDateAds:i}),null!==l&&void 0!==l&&(e={...e,expDateAdsGen:l}),await(0,o.mZ)((0,o.H9)(c,"users","".concat(t)),{...e,updateAt:p||new Date})}catch(d){console.error("Error updateCoinsUser: ",d)}},b=async e=>{let{id:t,data:a}=e;try{await(0,o.mZ)((0,o.H9)(c,"albums","".concat(t)),{albums:(0,o.hq)(a)})}catch(s){console.error("Error updateAlbumAccount: ",s)}},x=async e=>{let{id:t,data:a}=e;try{await(0,o.mZ)((0,o.H9)(c,"albums","".concat(t)),{albums:(0,o.C3)(a)})}catch(s){console.error("Error deleteAlbum: ",s)}},E=async e=>{let{id:t,cursor:a}=e;try{let e=[];const a=(0,o.H9)(c,"albums","".concat(t)),s=await(0,o.x7)(a);return s.exists()&&(e=s.data()),e.albums}catch(s){console.error("Error getAlbums: ",s)}},A=async e=>{try{let t;const a=(0,o.H9)(c,"users","".concat(e)),s=await(0,o.x7)(a);return s.exists()&&(t=s.data()),t}catch(t){console.error("Error getUser: ",t)}},S=async e=>{let{model:t,server:a,text:o,cursor:s}=e;try{"".concat(window.location.protocol,"//").concat(a);const e=new Headers;e.append("Content-Type","application/json"),e.append("Accept","application/json, text/plain, */*"),e.append("Accept-Language","en-US,en;q=0.9"),e.append("Referer","https://lexica.art/");return l.Ze}catch(n){return console.log("Kai Error ",n),{error:!0}}},v=async e=>{let{server:t,token:a,textKey:o,negativeKey:s,width:n,height:r,samples:c,steps:i,scale:l,seed:d}=e;try{const e="".concat(t,"/text-to-image"),c=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json",Accept:"image/png",Authorization:a},body:JSON.stringify({cfg_scale:l,clip_guidance_preset:"NONE",height:r,width:n,samples:1,steps:i,seed:d,text_prompts:[{text:o,weight:1},{text:s,weight:-1}]})});if(!c.ok)return{error:!0};let g=!0;c.headers&&c.headers.map&&"CONTENT_FILTERED"===c.headers.map["finish-reason"]&&(g=!1);const m=await c.blob();return{data:(await(0,p.Sk)(m)).replace("data:application/octet-stream;base64,","data:image/png;base64,"),isSuccess:g}}catch(g){return{error:!0}}},D=e=>{let{file:t,width:a=1024,height:o=1024}=e;return new Promise((e=>{g().imageFileResizer(t,a,o,"PNG",100,0,(t=>{e(t)}),"file",a,o)}))},T=async e=>{let{server:t,token:a,image:o,textKey:s,negativeKey:n,width:r,height:c,steps:i,samples:l,scale:d,seed:g,strength:m,stylePreset:h}=e;try{const e="".concat(t,"/image-to-image");let l=await D({file:o,width:r,height:c});const u=new FormData;u.append("init_image",l),u.append("cfg_scale",d),u.append("samples","1"),u.append("steps",i),u.append("seed",g),u.append("sampler","K_DPMPP_2M"),u.append("image_strength",m),u.append("text_prompts[0][text]",s),u.append("text_prompts[0][weight]","1"),u.append("text_prompts[1][text]",n),u.append("text_prompts[1][weight]","-1"),h&&u.append("style_preset",h);const w=await fetch(e,{method:"POST",headers:{Accept:"image/png",Authorization:a},credentials:"omit",body:u});if(!w.ok)return console.log("Error ",await w.text()),{error:!0};let y=!0;w.headers&&w.headers.map&&"CONTENT_FILTERED"===w.headers.map["finish-reason"]&&(y=!1);const f=await w.blob();return{data:(await(0,p.Sk)(f)).replace("data:application/octet-stream;base64,","data:image/png;base64,"),isSuccess:y}}catch(u){return console.log("Error requestImageToImage ",u),{error:!0}}},k=async e=>{let{server:t,token:a,textKey:o,negativeKey:s,image:n,strength:r,aspectRatio:c,seed:i,stylePreset:l,model:d="sd3-medium",width:g=512,height:m=512}=e;try{const e="".concat(t,"/generate/sd3"),h=new FormData;if(h.append("mode",n?"image-to-image":"text-to-image"),h.append("prompt",o),"sd3-large-turbo"!==d&&h.append("negative_prompt",s),n||h.append("aspect_ratio",c),h.append("seed",i),h.append("style_preset",l),h.append("model",d),n){let e=1-r,t=await D({file:n,width:g,height:m});h.append("image",t),h.append("strength",e)}const u=await fetch(e,{method:"POST",headers:{Accept:"image/*",Authorization:a},credentials:"omit",body:h});if(!u.ok)return console.log("Error ",await u.text()),{error:!0};let w=!0;u.headers&&u.headers.map&&"CONTENT_FILTERED"===u.headers.map["finish-reason"]&&(w=!1);const y=await u.blob();return{data:(await(0,p.Sk)(y)).replace("data:application/octet-stream;base64,","data:image/png;base64,"),isSuccess:w}}catch(h){return console.log("Error end",h),{error:!0}}},N=async e=>{let{server:t,token:a,textKey:o,negativeKey:s,aspectRatio:n,seed:r,stylePreset:c}=e;try{const e="".concat(t,"/generate/core"),i=new FormData;i.append("prompt",o),i.append("negative_prompt",s),i.append("aspect_ratio",n),i.append("seed",r),i.append("style_preset",c);const l=await fetch(e,{method:"POST",headers:{Accept:"image/*",Authorization:a},credentials:"omit",body:i});if(!l.ok)return console.log("Error ",await l.text()),{error:!0};let d=!0;l.headers&&l.headers.map&&"CONTENT_FILTERED"===l.headers.map["finish-reason"]&&(d=!1);const g=await l.blob();return{data:(await(0,p.Sk)(g)).replace("data:application/octet-stream;base64,","data:image/png;base64,"),isSuccess:d}}catch(i){return{error:!0}}},I=async e=>{let{server:t,token:a,textKey:o,negativeKey:s,aspectRatio:n,seed:r}=e;try{const e="".concat(t,"/generate/ultra"),c=new FormData;c.append("prompt",o),c.append("negative_prompt",s),c.append("aspect_ratio",n),c.append("seed",r);const i=await fetch(e,{method:"POST",headers:{Accept:"image/*",Authorization:a},credentials:"omit",body:c});if(!i.ok)return console.log("Error ",await i.text()),{error:!0};let l=!0;i.headers&&i.headers.map&&"CONTENT_FILTERED"===i.headers.map["finish-reason"]&&(l=!1);const d=await i.blob();return{data:(await(0,p.Sk)(d)).replace("data:application/octet-stream;base64,","data:image/png;base64,"),isSuccess:l}}catch(c){return{error:!0}}},K=async e=>{let{server:t,token:a,textKey:o,negativeKey:s,steps:n,width:r,height:c,scale:i,seed:l,samples:d,samplerIndex:g,model:m,isControl:h,controlNets:u,isHD:w}=e;try{const e="".concat(t,"/txt2img"),y=new Headers;y.append("Authorization","Bearer ".concat(a)),y.append("content-type","application/json"),y.append("accept","application/json"),console.log("ADDRESS ",e),console.log("textKey ",o),console.log("negativeKey ",s),console.log("steps ",n),console.log("width ",r),console.log("height ",c),console.log("scale ",i),console.log("seed ",l),console.log("samples ",d),console.log("modelName ",m),console.log("samplerIndex ",g),console.log("isHD ",w),console.log("isControl ",h),console.log("controlNets ",u);let f={extra:{enable_nsfw_detection:!1},prompt:o,negative_prompt:s,sampler_name:g||"Euler a",batch_size:d||1,steps:n,cfg_scale:i,seed:l||-1,width:r,height:c,model_name:m||"anyhentai_20_31826.safetensors"};h&&(f={...f,alwayson_scripts:{controlnet:{args:[...u]}}}),w&&(f={...f,enable_hr:!0,hr_upscaler:"R-ESRGAN 4x+",hr_scale:2});const _=await fetch(e,{method:"POST",headers:y,body:JSON.stringify(f)});if(200!==_.status)return console.log("Error ",await _.text()),{error:!0};const b=(await _.json()).data.task_id;let x,E="",A=0;for(;A<3600;){const e=await fetch("".concat(t,"/progress?task_id=").concat(b),{method:"GET",headers:y});if(x=await e.json(),2===x.data.status&&x.data.imgs.length){E=x.data.imgs[0];break}await(0,p.yy)(1e3),A++}return{data:E,isSuccess:!0}}catch(y){return console.log("Error ",y),{error:!0}}},R=async e=>{let{server:t,token:a,base64:o,textKey:s,negativeKey:n,steps:r,width:c,height:i,strength:l,scale:d,seed:g,samples:m,samplerIndex:h,model:u,isControl:w,controlNets:y}=e;try{const e="".concat(t,"/img2img"),f=new Headers;f.append("Authorization","Bearer ".concat(a)),f.append("content-type","application/json"),f.append("accept","application/json"),console.log("ADDRESS ",e),console.log("textKey ",s),console.log("negativeKey ",n),console.log("base64 ",o.length),console.log("steps ",r),console.log("width ",c),console.log("height ",i),console.log("strength ",1-l),console.log("scale ",d),console.log("seed ",g),console.log("samples ",m),console.log("samplerIndex ",h),console.log("isControl ",w),console.log("controlNets ",y),console.log("modelName ",u);let _={extra:{enable_nsfw_detection:!1},prompt:s,negative_prompt:n,sampler_name:h||"Euler a",batch_size:m||1,steps:r,cfg_scale:d,seed:g||-1,width:c,height:i,model_name:u||"anyhentai_20_31826.safetensors",denoising_strength:1-l,init_images:[o]};if(w){const e=[];for(let t=0;t<y.length;t++)e.push({...y[t],input_image:o});_={..._,controlnet_units:e}}const b=await fetch(e,{method:"POST",headers:f,body:JSON.stringify(_)});if(200!==b.status){const e=await b.text();return console.log("Error ",e),{error:!0,message:e}}const x=(await b.json()).data.task_id;let E,A="",S=0;for(;S<3600;){const e=await fetch("".concat(t,"/progress?task_id=").concat(x),{method:"GET",headers:f});if(E=await e.json(),2===E.data.status&&E.data.imgs.length){A=E.data.imgs[0];break}await(0,p.yy)(1e3),S++}return{data:A,isSuccess:!0}}catch(f){return console.log("Error ",f),{error:!0,message:f}}}},7385:(e,t,a)=>{a.d(t,{RZ:()=>s,Sk:()=>n,hs:()=>r,nJ:()=>c,yy:()=>o});const o=e=>new Promise((t=>setTimeout(t,e))),s=e=>{let{min:t,max:a}=e;return Math.floor(Math.random()*(a-t+1))+t},n=e=>new Promise(((t,a)=>{const o=new FileReader;o.onloadend=()=>t(o.result),o.readAsDataURL(e)})),r=async e=>{const t=await fetch(e),a=await t.blob();return new Promise(((e,t)=>{const o=new FileReader;o.readAsDataURL(a),o.onloadend=()=>{const t=o.result;e(t)},o.onerror=t}))},c=async e=>{let{imageSrc:t,rate:a,iw:o,ih:s}=e,n=0,r=0,c=0,l=0;s>o||s===o&&a>1?(n=0,r=s/2-o/(2*a),c=o,l=o/a,r<0&&(n=o/2-s*a/2,r=0,c=s*a,l=s)):(n=o/2-s*a/2,r=0,c=s*a,l=s,n<0&&(n=0,r=s/2-o/(2*a),c=o,l=o/a));const p=await(d=t,new Promise(((e,t)=>{const a=new Image;a.addEventListener("load",(()=>e(a))),a.addEventListener("error",(e=>t(e))),a.setAttribute("crossOrigin","anonymous"),a.src=d})));var d;const g=document.createElement("canvas"),m=g.getContext("2d");g.width=c,g.height=l,m.drawImage(p,n,r,c,l,0,0,c,l);const h=g.toDataURL("image/jpeg",1);return{file:i(h,"img.png"),base64:h}},i=(e,t)=>{for(var a=e.split(","),o=a[0].match(/:(.*?);/)[1],s=atob(a[1]),n=s.length,r=new Uint8Array(n);n--;)r[n]=s.charCodeAt(n);return new File([r],t,{type:o})}}}]);