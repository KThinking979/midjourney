"use strict";(self.webpackChunkmidjourney=self.webpackChunkmidjourney||[]).push([[712],{70712:(e,t,a)=>{a.d(t,{kg:()=>w,Dn:()=>A,Ww:()=>u,Zt:()=>x,Y_:()=>h,xD:()=>S,Vo:()=>y,wz:()=>b,Kh:()=>N,eL:()=>C,W_:()=>H,v7:()=>I,aB:()=>F,fO:()=>j,EQ:()=>P,DS:()=>O,F:()=>v,Ip:()=>K,jV:()=>D,ym:()=>z,rj:()=>G,J3:()=>R,ZJ:()=>T,sS:()=>m,Y4:()=>E,bF:()=>_,im:()=>k,TK:()=>f,jH:()=>g});var r=a(66220),s=a(90815),n=a(39751);const o=(0,s.Wp)({apiKey:"AIzaSyBOTVOdSu20rXHX_VWHnV3XmS9ZcnfQuBQ",authDomain:"midjourneyai-71161.firebaseapp.com",projectId:"midjourneyai-71161",storageBucket:"midjourneyai-71161.appspot.com",messagingSenderId:"559017193613",appId:"1:559017193613:web:8f4159f592c0a63e4e32c4",measurementId:"G-FEN6H6F61Y"}),c=(0,r.aU)(o),i=(0,n.c7)(o);a(44456);var l=a(67385),d=a(94651),p=a.n(d);const m=async e=>{let{text:t,targetLanguage:a,apiKey:r}=e;try{const e="https://translation.googleapis.com/language/translate/v2?key=".concat(r);if(""===t)return{data:t,isSuccess:!0};const s={q:t,target:a},n=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(200!==n.status)return console.log("Error ",await n.text()),{error:!0};const o=await n.json();return console.log("_response ",o.data),{data:o.data.translations[0].translatedText,isSuccess:!0}}catch(s){return{error:!0}}},g=async e=>{let{name:t,data:a,folder:r="INPUT",isUrl:s}=e,o="";const c="".concat(r,"/").concat(t),d=(0,n.KR)(i,c);let p=a;return s&&(p=await(0,l.hs)(a)),await(0,n.ls)(d,p,"data_url"),o=await(0,n.qk)(d),o},u=async e=>{let{url:t}=e;try{const e=t,a=(0,n.KR)(i,e);return await(0,n.XR)(a),!0}catch(a){console.log("Error deleteFile ",a)}},h=async()=>{try{let e;const t=(0,r.H9)(c,"configs","configs"),a=await(0,r.x7)(t);return a.exists()&&(e=a.data()),e}catch(e){console.error("Error getUser: ",e)}},y=async()=>{try{let e;const t=(0,r.H9)(c,"configs","listAIStyle"),a=await(0,r.x7)(t);return a.exists()&&(e=a.data()),e}catch(e){console.error("Error listAIStyle: ",e)}},w=async e=>{let{id:t,username:a,coins:s}=e;try{const e=(new Date).toISOString().slice(0,10).replace("-","").replace("-","");await(0,r.BN)((0,r.H9)(c,"users","".concat(t)),{id:"".concat(t),username:a,coins:s,numAds:1,numAdsGen:1,expDateAds:e,expDateAdsGen:e,language:"en",createdAt:new Date,updateAt:new Date})}catch(n){console.error("Error createUser: ",n)}},_=async e=>{let{id:t,coins:a,transactionId:s}=e;try{await(0,r.mZ)((0,r.H9)(c,"users","".concat(t)),{coins:a,updateAtTrans:"COIN_".concat(new Date),transactionId:"".concat(s)})}catch(n){console.error("Error updateCoinsUser: ",n)}},f=async e=>{let{id:t,coins:a,language:s,numAds:n,numAdsGen:o,expDateAds:i,expDateAdsGen:l,updatedAt:d}=e;try{let e={};s&&(e={...e,language:s}),null!==a&&void 0!==a&&(e={...e,coins:a}),null!==n&&void 0!==n&&(e={...e,numAds:n}),null!==o&&void 0!==o&&(e={...e,numAdsGen:o}),null!==i&&void 0!==i&&(e={...e,expDateAds:i}),null!==l&&void 0!==l&&(e={...e,expDateAdsGen:l}),await(0,r.mZ)((0,r.H9)(c,"users","".concat(t)),{...e,updateAt:d||new Date})}catch(p){console.error("Error updateCoinsUser: ",p)}},b=async e=>{try{let t;const a=(0,r.H9)(c,"users","".concat(e)),s=await(0,r.x7)(a);return s.exists()&&(t=s.data()),t}catch(t){console.error("Error getUser: ",t)}},E=async e=>{let{id:t,data:a}=e;try{await(0,r.BN)((0,r.H9)(c,"albums","".concat(t)),{...a,createdAt:new Date,updateAt:new Date})}catch(s){console.error("Error updateAlbumAccount: ",s)}},A=async e=>{let{id:t}=e;try{await(0,r.kd)((0,r.H9)(c,"albums","".concat(t)))}catch(a){console.error("Error deleteAlbum: ",a)}},x=async e=>{let{id:t,idLast:a,limited:s=25}=e;try{let e=[];const n=(0,r.rJ)(c,"albums");let o=(0,r.P)(n,(0,r._M)("userId","==","".concat(t)),(0,r.My)("createdAt","desc"),(0,r.AB)(s));if(a){const e=(0,r.H9)(c,"albums","".concat(a)),i=await(0,r.x7)(e);if(i.exists()){const e=i;o=(0,r.P)(n,(0,r._M)("userId","==","".concat(t)),(0,r.My)("createdAt","desc"),(0,r.HM)(e),(0,r.AB)(s))}else console.log("No such document!")}return(await(0,r.GG)(o)).forEach((t=>{e.push(t.data())})),e}catch(n){console.error("Error getAlbums: ",n)}},S=async e=>{let{idLast:t,queryText:a="",limited:s=25}=e;try{let e=[];const n=(0,r.rJ)(c,"listKeys");if(a&&""!==a){let o=(0,r.P)(n,(0,r.My)("textKey"),(0,r.EO)(a),(0,r.FD)(a+"\uf8ff"),(0,r.AB)(s));if(t){const e=(0,r.H9)(c,"listKeys","".concat(t)),i=await(0,r.x7)(e);if(i.exists()){const e=i;o=(0,r.P)(n,(0,r.My)("textKey"),(0,r.EO)(a),(0,r.FD)(a+"\uf8ff"),(0,r.HM)(e),(0,r.AB)(s))}else console.log("No such document!")}(await(0,r.GG)(o)).forEach((t=>{e.push(t.data())}))}else{let a=(0,r.P)(n,(0,r.My)("createdAt","asc"),(0,r.AB)(s));if(t){const e=(0,r.H9)(c,"listKeys","".concat(t)),o=await(0,r.x7)(e);if(o.exists()){const e=o;a=(0,r.P)(n,(0,r.My)("createdAt","asc"),(0,r.HM)(e),(0,r.AB)(s))}else console.log("No such document!")}(await(0,r.GG)(a)).forEach((t=>{e.push(t.data())}))}return e}catch(n){console.error("Error getAlbums: ",n)}},k=async e=>{let{id:t,data:a}=e;try{await(0,r.BN)((0,r.H9)(c,"listKeys","".concat(t)),{...a,createdAt:new Date,updateAt:new Date})}catch(s){console.error("Error updateKeys: ",s)}},T=e=>{let{file:t,width:a=1024,height:r=1024}=e;return new Promise((e=>{p().imageFileResizer(t,a,r,"PNG",100,0,(t=>{e(t)}),"file",a,r)}))},v=async e=>{let{server:t,token:a,textKey:r,negativeKey:s,width:n,height:o,samples:c,steps:i,scale:d,seed:p}=e;try{const e="".concat(t,"/text-to-image"),c=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json",Accept:"image/png",Authorization:a},body:JSON.stringify({cfg_scale:d,clip_guidance_preset:"NONE",height:o,width:n,samples:1,steps:i,seed:p,text_prompts:[{text:r,weight:1},{text:s,weight:-1}]})});if(!c.ok)return{error:!0};let m=!0;c.headers&&c.headers.map&&"CONTENT_FILTERED"===c.headers.map["finish-reason"]&&(m=!1);const g=await c.blob();return{data:(await(0,l.Sk)(g)).replace("data:application/octet-stream;base64,","data:image/png;base64,"),isSuccess:m}}catch(m){return{error:!0}}},j=async e=>{let{server:t,token:a,image:r,textKey:s,negativeKey:n,width:o,height:c,steps:i,samples:d,scale:p,seed:m,strength:g,stylePreset:u}=e;try{const e="".concat(t,"/image-to-image");let d=await T({file:r,width:o,height:c});const h=new FormData;h.append("init_image",d),h.append("cfg_scale",p),h.append("samples","1"),h.append("steps",i),h.append("seed",m),h.append("sampler","K_DPMPP_2M"),h.append("image_strength",g),h.append("text_prompts[0][text]",s),h.append("text_prompts[0][weight]","1"),h.append("text_prompts[1][text]",n),h.append("text_prompts[1][weight]","-1"),u&&h.append("style_preset",u);const y=await fetch(e,{method:"POST",headers:{Accept:"image/png",Authorization:a},credentials:"omit",body:h});if(!y.ok)return console.log("Error ",await y.text()),{error:!0};let w=!0;y.headers&&y.headers.map&&"CONTENT_FILTERED"===y.headers.map["finish-reason"]&&(w=!1);const _=await y.blob();return{data:(await(0,l.Sk)(_)).replace("data:application/octet-stream;base64,","data:image/png;base64,"),isSuccess:w}}catch(h){return console.log("Error requestImageToImage ",h),{error:!0}}},O=async e=>{let{server:t,token:a,textKey:r,negativeKey:s,image:n,strength:o,aspectRatio:c,seed:i,stylePreset:d,model:p="sd3-medium",width:m=512,height:g=512}=e;try{const e="".concat(t,"/generate/sd3"),u=new FormData;if(u.append("mode",n?"image-to-image":"text-to-image"),u.append("prompt",r),"sd3-large-turbo"!==p&&u.append("negative_prompt",s),n||u.append("aspect_ratio",c),u.append("seed",i),u.append("style_preset",d),u.append("model",p),n){let e=1-o,t=await T({file:n,width:m,height:g});u.append("image",t),u.append("strength",e)}const h=await fetch(e,{method:"POST",headers:{Accept:"image/*",Authorization:a},credentials:"omit",body:u});if(!h.ok)return console.log("Error ",await h.text()),{error:!0};let y=!0;h.headers&&h.headers.map&&"CONTENT_FILTERED"===h.headers.map["finish-reason"]&&(y=!1);const w=await h.blob();return{data:(await(0,l.Sk)(w)).replace("data:application/octet-stream;base64,","data:image/png;base64,"),isSuccess:y}}catch(u){return console.log("Error end",u),{error:!0}}},N=async e=>{let{server:t,token:a,textKey:r,negativeKey:s,aspectRatio:n,seed:o,stylePreset:c}=e;try{const e="".concat(t,"/generate/core"),i=new FormData;i.append("prompt",r),i.append("negative_prompt",s),i.append("aspect_ratio",n),i.append("seed",o),i.append("style_preset",c);const d=await fetch(e,{method:"POST",headers:{Accept:"image/*",Authorization:a},credentials:"omit",body:i});if(!d.ok)return console.log("Error ",await d.text()),{error:!0};let p=!0;d.headers&&d.headers.map&&"CONTENT_FILTERED"===d.headers.map["finish-reason"]&&(p=!1);const m=await d.blob();return{data:(await(0,l.Sk)(m)).replace("data:application/octet-stream;base64,","data:image/png;base64,"),isSuccess:p}}catch(i){return{error:!0}}},D=async e=>{let{server:t,token:a,textKey:r,negativeKey:s,aspectRatio:n,seed:o}=e;try{const e="".concat(t,"/generate/ultra"),c=new FormData;c.append("prompt",r),c.append("negative_prompt",s),c.append("aspect_ratio",n),c.append("seed",o);const i=await fetch(e,{method:"POST",headers:{Accept:"image/*",Authorization:a},credentials:"omit",body:c});if(!i.ok)return console.log("Error ",await i.text()),{error:!0};let d=!0;i.headers&&i.headers.map&&"CONTENT_FILTERED"===i.headers.map["finish-reason"]&&(d=!1);const p=await i.blob();return{data:(await(0,l.Sk)(p)).replace("data:application/octet-stream;base64,","data:image/png;base64,"),isSuccess:d}}catch(c){return{error:!0}}},K=async e=>{let{server:t,token:a,textKey:r,negativeKey:s,steps:n,width:o,height:c,scale:i,seed:d,samples:p,samplerIndex:m,model:g,isControl:u,controlNets:h,isHD:y}=e;try{const e="".concat(t,"/txt2img"),w=new Headers;w.append("Authorization","Bearer ".concat(a)),w.append("content-type","application/json"),w.append("accept","application/json");let _={extra:{enable_nsfw_detection:!1},prompt:r,negative_prompt:s,sampler_name:m||"Euler a",batch_size:p||1,steps:n,cfg_scale:i,seed:d||-1,width:o,height:c,model_name:g||"anyhentai_20_31826.safetensors"};u&&(_={..._,alwayson_scripts:{controlnet:{args:[...h]}}}),y&&(_={..._,enable_hr:!0,hr_upscaler:"R-ESRGAN 4x+",hr_scale:2});const f=await fetch(e,{method:"POST",headers:w,body:JSON.stringify(_)});if(200!==f.status)return console.log("Error ",await f.text()),{error:!0};const b=(await f.json()).data.task_id;let E,A="",x=0;for(;x<3600;){const e=await fetch("".concat(t,"/progress?task_id=").concat(b),{method:"GET",headers:w});if(E=await e.json(),2===E.data.status&&E.data.imgs.length){A=E.data.imgs[0];break}await(0,l.yy)(1e3),x++}return{data:A,isSuccess:!0}}catch(w){return console.log("Error ",w),{error:!0}}},P=async e=>{let{server:t,token:a,base64:r,textKey:s,negativeKey:n,steps:o,width:c,height:i,strength:d,scale:p,seed:m,samples:g,samplerIndex:u,model:h,isControl:y,controlNets:w}=e;try{const e="".concat(t,"/img2img"),_=new Headers;_.append("Authorization","Bearer ".concat(a)),_.append("content-type","application/json"),_.append("accept","application/json");let f={extra:{enable_nsfw_detection:!1},prompt:s,negative_prompt:n,sampler_name:u||"Euler a",batch_size:g||1,steps:o,cfg_scale:p,seed:m||-1,width:c,height:i,model_name:h||"anyhentai_20_31826.safetensors",denoising_strength:1-d,init_images:[r]};if(y){const e=[];for(let t=0;t<w.length;t++)e.push({...w[t],input_image:r});f={...f,controlnet_units:e}}const b=await fetch(e,{method:"POST",headers:_,body:JSON.stringify(f)});if(200!==b.status){const e=await b.text();return console.log("Error ",e),{error:!0,message:e}}const E=(await b.json()).data.task_id;let A,x="",S=0;for(;S<3600;){const e=await fetch("".concat(t,"/progress?task_id=").concat(E),{method:"GET",headers:_});if(A=await e.json(),2===A.data.status&&A.data.imgs.length){x=A.data.imgs[0];break}await(0,l.yy)(1e3),S++}return{data:x,isSuccess:!0}}catch(_){return console.log("Error ",_),{error:!0,message:_}}},I=async e=>{let{server:t,token:a,base64:r,textKey:s,negativeKey:n,steps:o,width:c,height:i,strength:d,scale:p,seed:m,samples:g,samplerIndex:u,model:h,isControl:y,controlNets:w}=e;try{const e="".concat(t,"/img2img"),d=new Headers;d.append("Authorization","Bearer ".concat(a)),d.append("content-type","application/json"),d.append("accept","application/json");let _={extra:{enable_nsfw_detection:!1},prompt:s,negative_prompt:n,sampler_name:u||"Euler a",batch_size:g||1,steps:o,cfg_scale:p,seed:m||-1,width:c,height:i,model_name:h||"anyhentai_20_31826.safetensors",denoising_strength:1,init_images:[r]};if(y){const e=[];for(let t=0;t<w.length;t++)e.push({...w[t],input_image:r});_={..._,controlnet_units:e}}const f=await fetch(e,{method:"POST",headers:d,body:JSON.stringify(_)});if(200!==f.status){const e=await f.text();return console.log("Error ",e),{error:!0,message:e}}const b=(await f.json()).data.task_id;let E,A="",x=0;for(;x<3600;){const e=await fetch("".concat(t,"/progress?task_id=").concat(b),{method:"GET",headers:d});if(E=await e.json(),2===E.data.status&&E.data.imgs.length){A=E.data.imgs[0];break}await(0,l.yy)(1e3),x++}return{data:A,isSuccess:!0}}catch(_){return console.log("Error ",_),{error:!0,message:_}}},F=async e=>{let{server:t,token:a,base64:r,textKey:s,negativeKey:n,steps:o,width:c,height:i,strength:d,scale:p,seed:m,samples:g,samplerIndex:u,model:h,isControl:y,controlNets:w}=e;try{const e="".concat(t,"/img2img"),d=new Headers;d.append("Authorization","Bearer ".concat(a)),d.append("content-type","application/json"),d.append("accept","application/json");let _={extra:{enable_nsfw_detection:!1},request:{model_name:h||"anyhentai_20_31826.safetensors",image_base64:r,prompt:s,negative_prompt:n,width:c,height:i,image_num:g||1,steps:o,seed:m||-1,guidance_scale:p,sampler_name:u||"Euler a",strength:1}};if(y){const e=[];for(let t=0;t<w.length;t++)e.push({...w[t],image_base64:r});_.request={..._.request,controlnet:{units:e}}}const f=await fetch(e,{method:"POST",headers:d,body:JSON.stringify(_)});if(200!==f.status){const e=await f.text();return console.log("Error ",e),{error:!0,message:e}}const b=(await f.json()).task_id;let E,A="",x=0;for(;x<3600;){const e=await fetch("".concat(t,"/task-result?task_id=").concat(b),{method:"GET",headers:d});if(E=await e.json(),"TASK_STATUS_SUCCEED"===E.task.status&&E.images.length){A=E.images[0].image_url;break}await(0,l.yy)(1e3),x++}return{data:A,isSuccess:!0}}catch(_){return console.log("Error ",_),{error:!0,message:_}}},C=async e=>{let{server:t,token:a,image:r,isRemoveBg:s}=e;try{const e="".concat(t,"/face-to-sticker"),n={image_url:r.url,prompt:"high quality",image_size:"square_hd",num_inference_steps:20,guidance_scale:4.5,instant_id_strength:.85,ip_adapter_weight:.2,ip_adapter_noise:.5,upscale_steps:10,enable_safety_checker:!1},o=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:a},body:JSON.stringify(n)});if(200!==o.status)return console.log("Error ",await o.text()),{error:!0};const c=await o.json();return c.images.length?(console.log("_response ",c),{data:s?c.sticker_image_background_removed.url:c.sticker_image.url,isSuccess:!0}):{error:!0}}catch(n){return console.log("Error requestFaceSticker ",n),{error:!0}}},H=async e=>{let{server:t,token:a,baseImage:r,swapImage:s}=e;try{const e="".concat(t,"/face-swap"),n={base_image_url:r.url,swap_image_url:s.url},o=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:a},body:JSON.stringify(n)});if(200!==o.status)return{error:!0};const c=await o.json();return c.image?{data:c.image.url,isSuccess:!0}:{error:!0}}catch(n){return{error:!0}}},R=async e=>{let{server:t,token:a,image:r,upscaleFactor:s=2,face:n=!1,model:o}=e;try{const e="".concat(t,"/esrgan"),o={image_url:r.url,scale:s,face:n||!1,model:"RealESRGAN_x4plus"},c=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:a},body:JSON.stringify(o)});if(200!==c.status)return console.log("Error ",await c.text()),{error:!0};const i=await c.json();return i.image?{data:i.image.url,isSuccess:!0}:{error:!0}}catch(c){return console.log("Error requestFaceSticker ",c),{error:!0}}},z=async e=>{let{server:t,token:a,image:r,upscaleFactor:s=2,steps:n,scale:o,seed:c}=e;try{const e="".concat(t,"/ccsr"),o={image_url:r.url,scale:s,steps:n,seed:c},i=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:a},body:JSON.stringify(o)});if(200!==i.status)return console.log("Error ",await i.text()),{error:!0};const l=await i.json();return l.image?{data:l.image.url,isSuccess:!0}:{error:!0}}catch(i){return console.log("Error requestFaceSticker ",i),{error:!0}}},G=async e=>{let{server:t,token:a,image:r,upscaleFactor:s=2,textKey:n,negativeKey:o,steps:c,scale:i,seed:l}=e;try{const e="".concat(t,"/clarity-upscaler"),d={image_url:r.url,upscale_factor:s,prompt:n&&""!==n?n:"masterpiece, best quality, highres",negative_prompt:o&&""!==o?o:"(worst quality, low quality, normal quality:2)",num_inference_steps:c,seed:l,guidance_scale:i},p=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:a},body:JSON.stringify(d)});if(200!==p.status)return console.log("Error ",await p.text()),{error:!0};const m=await p.json();return m.image?{data:m.image.url,isSuccess:!0}:{error:!0}}catch(d){return console.log("Error requestFaceSticker ",d),{error:!0}}}},67385:(e,t,a)=>{a.d(t,{RZ:()=>s,Sk:()=>n,hs:()=>o,nJ:()=>c,yy:()=>r});const r=e=>new Promise((t=>setTimeout(t,e))),s=e=>{let{min:t,max:a}=e;return Math.floor(Math.random()*(a-t+1))+t},n=e=>new Promise(((t,a)=>{const r=new FileReader;r.onloadend=()=>t(r.result),r.readAsDataURL(e)})),o=async e=>{const t=await fetch(e),a=await t.blob();return new Promise(((e,t)=>{const r=new FileReader;r.readAsDataURL(a),r.onloadend=()=>{const t=r.result;e(t)},r.onerror=t}))},c=async e=>{let{imageSrc:t,rate:a,iw:r,ih:s}=e,n=0,o=0,c=0,l=0;s>r||s===r&&a>1?(n=0,o=s/2-r/(2*a),c=r,l=r/a,o<0&&(n=r/2-s*a/2,o=0,c=s*a,l=s)):(n=r/2-s*a/2,o=0,c=s*a,l=s,n<0&&(n=0,o=s/2-r/(2*a),c=r,l=r/a));const d=await(p=t,new Promise(((e,t)=>{const a=new Image;a.addEventListener("load",(()=>e(a))),a.addEventListener("error",(e=>t(e))),a.setAttribute("crossOrigin","anonymous"),a.src=p})));var p;const m=document.createElement("canvas"),g=m.getContext("2d");m.width=c,m.height=l,g.drawImage(d,n,o,c,l,0,0,c,l);const u=m.toDataURL("image/jpeg",1);return{file:i(u,"img.png"),base64:u}},i=(e,t)=>{for(var a=e.split(","),r=a[0].match(/:(.*?);/)[1],s=atob(a[1]),n=s.length,o=new Uint8Array(n);n--;)o[n]=s.charCodeAt(n);return new File([o],t,{type:r})}}}]);