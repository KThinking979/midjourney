"use strict";(self.webpackChunkemojifi=self.webpackChunkemojifi||[]).push([[712],{712:(e,t,o)=>{o.d(t,{kg:()=>y,Dn:()=>b,Ww:()=>h,Zt:()=>A,Y_:()=>u,Vo:()=>w,wz:()=>E,fO:()=>I,EQ:()=>k,FH:()=>S,F:()=>D,Ip:()=>v,Y4:()=>x,bF:()=>_,TK:()=>f,jH:()=>m});var a=o(6220),s=o(815),n=o(9751);const r=(0,s.Wp)({apiKey:"AIzaSyBOTVOdSu20rXHX_VWHnV3XmS9ZcnfQuBQ",authDomain:"midjourneyai-71161.firebaseapp.com",projectId:"midjourneyai-71161",storageBucket:"midjourneyai-71161.appspot.com",messagingSenderId:"559017193613",appId:"1:559017193613:web:8f4159f592c0a63e4e32c4",measurementId:"G-FEN6H6F61Y"}),c=(0,a.aU)(r),l=(0,n.c7)(r);var i=o(4456),d=o(7385),g=o(4651),p=o.n(g);const m=async e=>{let{name:t,data:o,folder:a="INPUT",isUrl:s}=e,r="";const c="".concat(a,"/").concat(t),i=(0,n.KR)(l,c);let g=o;return s&&(g=await(0,d.hs)(o)),await(0,n.ls)(i,g,"data_url"),r=await(0,n.qk)(i),r},h=async e=>{let{url:t}=e;try{const e=t,o=(0,n.KR)(l,e);return await(0,n.XR)(o),!0}catch(o){console.log("Error deleteFile ",o)}},u=async()=>{try{let e;const t=(0,a.H9)(c,"configs","configs"),o=await(0,a.x7)(t);return o.exists()&&(e=o.data()),e}catch(e){console.error("Error getUser: ",e)}},w=async()=>{try{let e;const t=(0,a.H9)(c,"configs","listAIStyle"),o=await(0,a.x7)(t);return o.exists()&&(e=o.data()),e}catch(e){console.error("Error listAIStyle: ",e)}},y=async e=>{let{id:t,username:o,coins:s}=e;try{const e=(new Date).toISOString().slice(0,10).replace("-","").replace("-","");await(0,a.BN)((0,a.H9)(c,"users","".concat(t)),{id:"".concat(t),username:o,coins:s,numAds:1,numAdsGen:1,expDateAds:e,expDateAdsGen:e,language:"en",createdAt:new Date,updateAt:new Date}),await(0,a.BN)((0,a.H9)(c,"albums","".concat(t)),{albums:[]})}catch(n){console.error("Error createUser: ",n)}},_=async e=>{let{id:t,coins:o,transactionId:s}=e;try{await(0,a.mZ)((0,a.H9)(c,"users","".concat(t)),{coins:o,updateAtTrans:"COIN_".concat(new Date),transactionId:"".concat(s)})}catch(n){console.error("Error updateCoinsUser: ",n)}},f=async e=>{let{id:t,coins:o,language:s,numAds:n,numAdsGen:r,expDateAds:l,expDateAdsGen:i,updatedAt:d}=e;try{let e={};s&&(e={...e,language:s}),null!==o&&void 0!==o&&(e={...e,coins:o}),null!==n&&void 0!==n&&(e={...e,numAds:n}),null!==r&&void 0!==r&&(e={...e,numAdsGen:r}),null!==l&&void 0!==l&&(e={...e,expDateAds:l}),null!==i&&void 0!==i&&(e={...e,expDateAdsGen:i}),await(0,a.mZ)((0,a.H9)(c,"users","".concat(t)),{...e,updateAt:d||new Date})}catch(g){console.error("Error updateCoinsUser: ",g)}},x=async e=>{let{id:t,data:o}=e;try{await(0,a.mZ)((0,a.H9)(c,"albums","".concat(t)),{albums:(0,a.hq)(o)})}catch(s){console.error("Error updateAlbumAccount: ",s)}},b=async e=>{let{id:t,data:o}=e;try{await(0,a.mZ)((0,a.H9)(c,"albums","".concat(t)),{albums:(0,a.C3)(o)})}catch(s){console.error("Error deleteAlbum: ",s)}},A=async e=>{let{id:t,cursor:o}=e;try{let e=[];const o=(0,a.H9)(c,"albums","".concat(t)),s=await(0,a.x7)(o);return s.exists()&&(e=s.data()),e.albums}catch(s){console.error("Error getAlbums: ",s)}},E=async e=>{try{let t;const o=(0,a.H9)(c,"users","".concat(e)),s=await(0,a.x7)(o);return s.exists()&&(t=s.data()),t}catch(t){console.error("Error getUser: ",t)}},S=async e=>{let{model:t,server:o,text:a,cursor:s}=e;try{"".concat(window.location.protocol,"//").concat(o);const e=new Headers;e.append("Content-Type","application/json"),e.append("Accept","application/json, text/plain, */*"),e.append("Accept-Language","en-US,en;q=0.9"),e.append("Referer","https://lexica.art/");return i.Ze}catch(n){return console.log("Kai Error ",n),{error:!0}}},D=async e=>{let{server:t,token:o,textKey:a,negativeKey:s,width:n,height:r,samples:c,steps:l,scale:i,seed:g}=e;try{const e="".concat(t,"/text-to-image");console.log("ADDRESS ",e),console.log("token ",o),console.log("textKey ",a),console.log("negativeKey ",s),console.log("steps ",l),console.log("samples, ",c),console.log("scale ",i),console.log("seed",g),console.log("width",n),console.log("height",r);const p=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json",Accept:"image/png",Authorization:o},body:JSON.stringify({cfg_scale:i,clip_guidance_preset:"NONE",height:r,width:n,samples:1,steps:l,seed:g,text_prompts:[{text:a,weight:1},{text:s,weight:-1}]})});if(!p.ok)return{error:!0};let m=!0;p.headers&&p.headers.map&&"CONTENT_FILTERED"===p.headers.map["finish-reason"]&&(m=!1);const h=await p.blob();return{data:(await(0,d.Sk)(h)).replace("data:application/octet-stream;base64,","data:image/png;base64,"),isSuccess:m}}catch(p){return{error:!0}}},I=async e=>{let{server:t,token:o,image:a,textKey:s,negativeKey:n,width:r,height:c,steps:l,samples:i,scale:g,seed:m,strength:h,stylePreset:u}=e;try{const e="".concat(t,"/image-to-image");console.log("ADDRESS ",e),console.log("token ",o),console.log("textKey ",s),console.log("negativeKey ",n),console.log("steps Img",l),console.log("image ImgPath",a),console.log("samples Img",i),console.log("scale Img",g),console.log("seed, Img",m),console.log("width",r),console.log("height",c),console.log("strength",h),console.log("style_preset",u);let w=await(e=>{let{file:t,width:o=1024,height:a=1024}=e;return new Promise((e=>{p().imageFileResizer(t,o,a,"PNG",100,0,(t=>{e(t)}),"file",o,a)}))})({file:a,width:r,height:c});console.log("resImage ",w);const y=new FormData;y.append("init_image",w),y.append("cfg_scale",g),y.append("samples","1"),y.append("steps",l),y.append("seed",m),y.append("sampler","K_DPMPP_2M"),y.append("image_strength",h),y.append("text_prompts[0][text]",s),y.append("text_prompts[0][weight]","1"),y.append("text_prompts[1][text]",n),y.append("text_prompts[1][weight]","-1"),u&&y.append("style_preset",u);const _=await fetch(e,{method:"POST",headers:{Accept:"image/png",Authorization:o},credentials:"omit",body:y});if(!_.ok)return console.log("Error ",await _.text()),{error:!0};let f=!0;_.headers&&_.headers.map&&"CONTENT_FILTERED"===_.headers.map["finish-reason"]&&(f=!1);const x=await _.blob();return{data:(await(0,d.Sk)(x)).replace("data:application/octet-stream;base64,","data:image/png;base64,"),isSuccess:f}}catch(w){return console.log("Error requestImageToImage ",w),{error:!0}}},v=async e=>{let{server:t,token:o,textKey:a,negativeKey:s,steps:n,width:r,height:c,scale:l,seed:i,samples:g,samplerIndex:p,model:m,isControl:h,controlNets:u,isHD:w}=e;try{const e="".concat(t,"/txt2img"),y=new Headers;y.append("Authorization","Bearer ".concat(o)),y.append("content-type","application/json"),y.append("accept","application/json"),console.log("ADDRESS ",e),console.log("textKey ",a),console.log("negativeKey ",s),console.log("steps ",n),console.log("width ",r),console.log("height ",c),console.log("scale ",l),console.log("seed ",i),console.log("samples ",g),console.log("modelName ",m),console.log("samplerIndex ",p),console.log("isHD ",w),console.log("isControl ",h),console.log("controlNets ",u);let _={extra:{enable_nsfw_detection:!1},prompt:a,negative_prompt:s,sampler_name:p||"Euler a",batch_size:g||1,steps:n,cfg_scale:l,seed:i||-1,width:r,height:c,model_name:m||"anyhentai_20_31826.safetensors"};h&&(_={..._,alwayson_scripts:{controlnet:{args:[...u]}}}),w&&(_={..._,enable_hr:!0,hr_upscaler:"R-ESRGAN 4x+",hr_scale:2});const f=await fetch(e,{method:"POST",headers:y,body:JSON.stringify(_)});if(200!==f.status)return console.log("Error ",await f.text()),{error:!0};const x=(await f.json()).data.task_id;let b,A="",E=0;for(;E<3600;){const e=await fetch("".concat(t,"/progress?task_id=").concat(x),{method:"GET",headers:y});if(b=await e.json(),2===b.data.status&&b.data.imgs.length){A=b.data.imgs[0];break}await(0,d.yy)(1e3),E++}return{data:A,isSuccess:!0}}catch(y){return console.log("Error ",y),{error:!0}}},k=async e=>{let{server:t,token:o,base64:a,textKey:s,negativeKey:n,steps:r,width:c,height:l,strength:i,scale:g,seed:p,samples:m,samplerIndex:h,model:u,isControl:w,controlNets:y}=e;try{const e="".concat(t,"/img2img"),_=new Headers;_.append("Authorization","Bearer ".concat(o)),_.append("content-type","application/json"),_.append("accept","application/json"),console.log("ADDRESS ",e),console.log("textKey ",s),console.log("negativeKey ",n),console.log("base64 ",a.length),console.log("steps ",r),console.log("width ",c),console.log("height ",l),console.log("strength ",1-i),console.log("scale ",g),console.log("seed ",p),console.log("samples ",m),console.log("samplerIndex ",h),console.log("isControl ",w),console.log("controlNets ",y),console.log("modelName ",u);let f={extra:{enable_nsfw_detection:!1},prompt:s,negative_prompt:n,sampler_name:h||"Euler a",batch_size:m||1,steps:r,cfg_scale:g,seed:p||-1,width:c,height:l,model_name:u||"anyhentai_20_31826.safetensors",denoising_strength:1-i,init_images:[a]};if(w){const e=[];for(let t=0;t<y.length;t++)e.push({...y[t],input_image:a});f={...f,controlnet_units:e}}const x=await fetch(e,{method:"POST",headers:_,body:JSON.stringify(f)});if(200!==x.status){const e=await x.text();return console.log("Error ",e),{error:!0,message:e}}const b=(await x.json()).data.task_id;let A,E="",S=0;for(;S<3600;){const e=await fetch("".concat(t,"/progress?task_id=").concat(b),{method:"GET",headers:_});if(A=await e.json(),2===A.data.status&&A.data.imgs.length){E=A.data.imgs[0];break}await(0,d.yy)(1e3),S++}return{data:E,isSuccess:!0}}catch(_){return console.log("Error ",_),{error:!0,message:_}}}},7385:(e,t,o)=>{o.d(t,{RZ:()=>s,Sk:()=>n,hs:()=>r,nJ:()=>c,yy:()=>a});const a=e=>new Promise((t=>setTimeout(t,e))),s=e=>{let{min:t,max:o}=e;return Math.floor(Math.random()*(o-t+1))+t},n=e=>new Promise(((t,o)=>{const a=new FileReader;a.onloadend=()=>t(a.result),a.readAsDataURL(e)})),r=async e=>{const t=await fetch(e),o=await t.blob();return new Promise(((e,t)=>{const a=new FileReader;a.readAsDataURL(o),a.onloadend=()=>{const t=a.result;e(t)},a.onerror=t}))},c=async e=>{let{imageSrc:t,rate:o,iw:a,ih:s}=e,n=0,r=0,c=0,i=0;s>a||s===a&&o>1?(n=0,r=s/2-a/(2*o),c=a,i=a/o,r<0&&(n=a/2-s*o/2,r=0,c=s*o,i=s)):(n=a/2-s*o/2,r=0,c=s*o,i=s,n<0&&(n=0,r=s/2-a/(2*o),c=a,i=a/o));const d=await(g=t,new Promise(((e,t)=>{const o=new Image;o.addEventListener("load",(()=>e(o))),o.addEventListener("error",(e=>t(e))),o.setAttribute("crossOrigin","anonymous"),o.src=g})));var g;const p=document.createElement("canvas"),m=p.getContext("2d");p.width=c,p.height=i,m.drawImage(d,n,r,c,i,0,0,c,i);const h=p.toDataURL("image/jpeg",1);return{file:l(h,"img.png"),base64:h}},l=(e,t)=>{for(var o=e.split(","),a=o[0].match(/:(.*?);/)[1],s=atob(o[1]),n=s.length,r=new Uint8Array(n);n--;)r[n]=s.charCodeAt(n);return new File([r],t,{type:a})}}}]);