"use strict";(self.webpackChunkemojifi=self.webpackChunkemojifi||[]).push([[712],{712:(e,t,a)=>{a.d(t,{kg:()=>_,Dn:()=>x,Ww:()=>h,Zt:()=>A,Y_:()=>u,Vo:()=>y,wz:()=>S,Kh:()=>N,eL:()=>H,W_:()=>R,v7:()=>P,aB:()=>C,fO:()=>j,EQ:()=>K,DS:()=>I,FH:()=>k,F:()=>T,Ip:()=>D,jV:()=>O,Y4:()=>E,bF:()=>f,P4:()=>w,TK:()=>b,jH:()=>g});var r=a(6220),s=a(815),n=a(9751);const o=(0,s.Wp)({apiKey:"AIzaSyBOTVOdSu20rXHX_VWHnV3XmS9ZcnfQuBQ",authDomain:"midjourneyai-71161.firebaseapp.com",projectId:"midjourneyai-71161",storageBucket:"midjourneyai-71161.appspot.com",messagingSenderId:"559017193613",appId:"1:559017193613:web:8f4159f592c0a63e4e32c4",measurementId:"G-FEN6H6F61Y"}),i=(0,r.aU)(o),c=(0,n.c7)(o);var p=a(4456),d=a(7385),l=a(4651),m=a.n(l);const g=async e=>{let{name:t,data:a,folder:r="INPUT",isUrl:s}=e,o="";const i="".concat(r,"/").concat(t),p=(0,n.KR)(c,i);let l=a;return s&&(l=await(0,d.hs)(a)),await(0,n.ls)(p,l,"data_url"),o=await(0,n.qk)(p),o},h=async e=>{let{url:t}=e;try{const e=t,a=(0,n.KR)(c,e);return await(0,n.XR)(a),!0}catch(a){console.log("Error deleteFile ",a)}},u=async()=>{try{let e;const t=(0,r.H9)(i,"configs","configs"),a=await(0,r.x7)(t);return a.exists()&&(e=a.data()),e}catch(e){console.error("Error getUser: ",e)}},w=async e=>{let{data:t}=e;try{await(0,r.mZ)((0,r.H9)(i,"configs","listAIStyle"),{listAIStyleUpscale:t})}catch(a){console.error("Error updateConfigs: ",a)}},y=async()=>{try{let e;const t=(0,r.H9)(i,"configs","listAIStyle"),a=await(0,r.x7)(t);return a.exists()&&(e=a.data()),e}catch(e){console.error("Error listAIStyle: ",e)}},_=async e=>{let{id:t,username:a,coins:s}=e;try{const e=(new Date).toISOString().slice(0,10).replace("-","").replace("-","");await(0,r.BN)((0,r.H9)(i,"users","".concat(t)),{id:"".concat(t),username:a,coins:s,numAds:1,numAdsGen:1,expDateAds:e,expDateAdsGen:e,language:"en",createdAt:new Date,updateAt:new Date}),await(0,r.BN)((0,r.H9)(i,"albums","".concat(t)),{albums:[]})}catch(n){console.error("Error createUser: ",n)}},f=async e=>{let{id:t,coins:a,transactionId:s}=e;try{await(0,r.mZ)((0,r.H9)(i,"users","".concat(t)),{coins:a,updateAtTrans:"COIN_".concat(new Date),transactionId:"".concat(s)})}catch(n){console.error("Error updateCoinsUser: ",n)}},b=async e=>{let{id:t,coins:a,language:s,numAds:n,numAdsGen:o,expDateAds:c,expDateAdsGen:p,updatedAt:d}=e;try{let e={};s&&(e={...e,language:s}),null!==a&&void 0!==a&&(e={...e,coins:a}),null!==n&&void 0!==n&&(e={...e,numAds:n}),null!==o&&void 0!==o&&(e={...e,numAdsGen:o}),null!==c&&void 0!==c&&(e={...e,expDateAds:c}),null!==p&&void 0!==p&&(e={...e,expDateAdsGen:p}),await(0,r.mZ)((0,r.H9)(i,"users","".concat(t)),{...e,updateAt:d||new Date})}catch(l){console.error("Error updateCoinsUser: ",l)}},E=async e=>{let{id:t,data:a}=e;try{await(0,r.mZ)((0,r.H9)(i,"albums","".concat(t)),{albums:(0,r.hq)(a)})}catch(s){console.error("Error updateAlbumAccount: ",s)}},x=async e=>{let{id:t,data:a}=e;try{await(0,r.mZ)((0,r.H9)(i,"albums","".concat(t)),{albums:(0,r.C3)(a)})}catch(s){console.error("Error deleteAlbum: ",s)}},A=async e=>{let{id:t,cursor:a}=e;try{let e=[];const a=(0,r.H9)(i,"albums","".concat(t)),s=await(0,r.x7)(a);return s.exists()&&(e=s.data()),e.albums}catch(s){console.error("Error getAlbums: ",s)}},S=async e=>{try{let t;const a=(0,r.H9)(i,"users","".concat(e)),s=await(0,r.x7)(a);return s.exists()&&(t=s.data()),t}catch(t){console.error("Error getUser: ",t)}},k=async e=>{let{model:t,server:a,text:r,cursor:s}=e;try{"".concat(window.location.protocol,"//").concat(a);const e=new Headers;e.append("Content-Type","application/json"),e.append("Accept","application/json, text/plain, */*"),e.append("Accept-Language","en-US,en;q=0.9"),e.append("Referer","https://lexica.art/");return p.Ze}catch(n){return console.log("Kai Error ",n),{error:!0}}},v=e=>{let{file:t,width:a=1024,height:r=1024}=e;return new Promise((e=>{m().imageFileResizer(t,a,r,"PNG",100,0,(t=>{e(t)}),"file",a,r)}))},T=async e=>{let{server:t,token:a,textKey:r,negativeKey:s,width:n,height:o,samples:i,steps:c,scale:p,seed:l}=e;try{const e="".concat(t,"/text-to-image"),i=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json",Accept:"image/png",Authorization:a},body:JSON.stringify({cfg_scale:p,clip_guidance_preset:"NONE",height:o,width:n,samples:1,steps:c,seed:l,text_prompts:[{text:r,weight:1},{text:s,weight:-1}]})});if(!i.ok)return{error:!0};let m=!0;i.headers&&i.headers.map&&"CONTENT_FILTERED"===i.headers.map["finish-reason"]&&(m=!1);const g=await i.blob();return{data:(await(0,d.Sk)(g)).replace("data:application/octet-stream;base64,","data:image/png;base64,"),isSuccess:m}}catch(m){return{error:!0}}},j=async e=>{let{server:t,token:a,image:r,textKey:s,negativeKey:n,width:o,height:i,steps:c,samples:p,scale:l,seed:m,strength:g,stylePreset:h}=e;try{const e="".concat(t,"/image-to-image");let p=await v({file:r,width:o,height:i});const u=new FormData;u.append("init_image",p),u.append("cfg_scale",l),u.append("samples","1"),u.append("steps",c),u.append("seed",m),u.append("sampler","K_DPMPP_2M"),u.append("image_strength",g),u.append("text_prompts[0][text]",s),u.append("text_prompts[0][weight]","1"),u.append("text_prompts[1][text]",n),u.append("text_prompts[1][weight]","-1"),h&&u.append("style_preset",h);const w=await fetch(e,{method:"POST",headers:{Accept:"image/png",Authorization:a},credentials:"omit",body:u});if(!w.ok)return console.log("Error ",await w.text()),{error:!0};let y=!0;w.headers&&w.headers.map&&"CONTENT_FILTERED"===w.headers.map["finish-reason"]&&(y=!1);const _=await w.blob();return{data:(await(0,d.Sk)(_)).replace("data:application/octet-stream;base64,","data:image/png;base64,"),isSuccess:y}}catch(u){return console.log("Error requestImageToImage ",u),{error:!0}}},I=async e=>{let{server:t,token:a,textKey:r,negativeKey:s,image:n,strength:o,aspectRatio:i,seed:c,stylePreset:p,model:l="sd3-medium",width:m=512,height:g=512}=e;try{const e="".concat(t,"/generate/sd3"),h=new FormData;if(h.append("mode",n?"image-to-image":"text-to-image"),h.append("prompt",r),"sd3-large-turbo"!==l&&h.append("negative_prompt",s),n||h.append("aspect_ratio",i),h.append("seed",c),h.append("style_preset",p),h.append("model",l),n){let e=1-o,t=await v({file:n,width:m,height:g});h.append("image",t),h.append("strength",e)}const u=await fetch(e,{method:"POST",headers:{Accept:"image/*",Authorization:a},credentials:"omit",body:h});if(!u.ok)return console.log("Error ",await u.text()),{error:!0};let w=!0;u.headers&&u.headers.map&&"CONTENT_FILTERED"===u.headers.map["finish-reason"]&&(w=!1);const y=await u.blob();return{data:(await(0,d.Sk)(y)).replace("data:application/octet-stream;base64,","data:image/png;base64,"),isSuccess:w}}catch(h){return console.log("Error end",h),{error:!0}}},N=async e=>{let{server:t,token:a,textKey:r,negativeKey:s,aspectRatio:n,seed:o,stylePreset:i}=e;try{const e="".concat(t,"/generate/core"),c=new FormData;c.append("prompt",r),c.append("negative_prompt",s),c.append("aspect_ratio",n),c.append("seed",o),c.append("style_preset",i);const p=await fetch(e,{method:"POST",headers:{Accept:"image/*",Authorization:a},credentials:"omit",body:c});if(!p.ok)return console.log("Error ",await p.text()),{error:!0};let l=!0;p.headers&&p.headers.map&&"CONTENT_FILTERED"===p.headers.map["finish-reason"]&&(l=!1);const m=await p.blob();return{data:(await(0,d.Sk)(m)).replace("data:application/octet-stream;base64,","data:image/png;base64,"),isSuccess:l}}catch(c){return{error:!0}}},O=async e=>{let{server:t,token:a,textKey:r,negativeKey:s,aspectRatio:n,seed:o}=e;try{const e="".concat(t,"/generate/ultra"),i=new FormData;i.append("prompt",r),i.append("negative_prompt",s),i.append("aspect_ratio",n),i.append("seed",o);const c=await fetch(e,{method:"POST",headers:{Accept:"image/*",Authorization:a},credentials:"omit",body:i});if(!c.ok)return console.log("Error ",await c.text()),{error:!0};let p=!0;c.headers&&c.headers.map&&"CONTENT_FILTERED"===c.headers.map["finish-reason"]&&(p=!1);const l=await c.blob();return{data:(await(0,d.Sk)(l)).replace("data:application/octet-stream;base64,","data:image/png;base64,"),isSuccess:p}}catch(i){return{error:!0}}},D=async e=>{let{server:t,token:a,textKey:r,negativeKey:s,steps:n,width:o,height:i,scale:c,seed:p,samples:l,samplerIndex:m,model:g,isControl:h,controlNets:u,isHD:w}=e;try{const e="".concat(t,"/txt2img"),y=new Headers;y.append("Authorization","Bearer ".concat(a)),y.append("content-type","application/json"),y.append("accept","application/json");let _={extra:{enable_nsfw_detection:!1},prompt:r,negative_prompt:s,sampler_name:m||"Euler a",batch_size:l||1,steps:n,cfg_scale:c,seed:p||-1,width:o,height:i,model_name:g||"anyhentai_20_31826.safetensors"};h&&(_={..._,alwayson_scripts:{controlnet:{args:[...u]}}}),w&&(_={..._,enable_hr:!0,hr_upscaler:"R-ESRGAN 4x+",hr_scale:2});const f=await fetch(e,{method:"POST",headers:y,body:JSON.stringify(_)});if(200!==f.status)return console.log("Error ",await f.text()),{error:!0};const b=(await f.json()).data.task_id;let E,x="",A=0;for(;A<3600;){const e=await fetch("".concat(t,"/progress?task_id=").concat(b),{method:"GET",headers:y});if(E=await e.json(),2===E.data.status&&E.data.imgs.length){x=E.data.imgs[0];break}await(0,d.yy)(1e3),A++}return{data:x,isSuccess:!0}}catch(y){return console.log("Error ",y),{error:!0}}},K=async e=>{let{server:t,token:a,base64:r,textKey:s,negativeKey:n,steps:o,width:i,height:c,strength:p,scale:l,seed:m,samples:g,samplerIndex:h,model:u,isControl:w,controlNets:y}=e;try{const e="".concat(t,"/img2img"),_=new Headers;_.append("Authorization","Bearer ".concat(a)),_.append("content-type","application/json"),_.append("accept","application/json");let f={extra:{enable_nsfw_detection:!1},prompt:s,negative_prompt:n,sampler_name:h||"Euler a",batch_size:g||1,steps:o,cfg_scale:l,seed:m||-1,width:i,height:c,model_name:u||"anyhentai_20_31826.safetensors",denoising_strength:1-p,init_images:[r]};if(w){const e=[];for(let t=0;t<y.length;t++)e.push({...y[t],input_image:r});f={...f,controlnet_units:e}}const b=await fetch(e,{method:"POST",headers:_,body:JSON.stringify(f)});if(200!==b.status){const e=await b.text();return console.log("Error ",e),{error:!0,message:e}}const E=(await b.json()).data.task_id;let x,A="",S=0;for(;S<3600;){const e=await fetch("".concat(t,"/progress?task_id=").concat(E),{method:"GET",headers:_});if(x=await e.json(),2===x.data.status&&x.data.imgs.length){A=x.data.imgs[0];break}await(0,d.yy)(1e3),S++}return{data:A,isSuccess:!0}}catch(_){return console.log("Error ",_),{error:!0,message:_}}},P=async e=>{let{server:t,token:a,base64:r,textKey:s,negativeKey:n,steps:o,width:i,height:c,strength:p,scale:l,seed:m,samples:g,samplerIndex:h,model:u,isControl:w,controlNets:y}=e;try{const e="".concat(t,"/img2img"),p=new Headers;p.append("Authorization","Bearer ".concat(a)),p.append("content-type","application/json"),p.append("accept","application/json");let _={extra:{enable_nsfw_detection:!1},prompt:s,negative_prompt:n,sampler_name:h||"Euler a",batch_size:g||1,steps:o,cfg_scale:l,seed:m||-1,width:i,height:c,model_name:u||"anyhentai_20_31826.safetensors",denoising_strength:1,init_images:[r]};if(w){const e=[];for(let t=0;t<y.length;t++)e.push({...y[t],input_image:r});_={..._,controlnet_units:e}}const f=await fetch(e,{method:"POST",headers:p,body:JSON.stringify(_)});if(200!==f.status){const e=await f.text();return console.log("Error ",e),{error:!0,message:e}}const b=(await f.json()).data.task_id;let E,x="",A=0;for(;A<3600;){const e=await fetch("".concat(t,"/progress?task_id=").concat(b),{method:"GET",headers:p});if(E=await e.json(),2===E.data.status&&E.data.imgs.length){x=E.data.imgs[0];break}await(0,d.yy)(1e3),A++}return{data:x,isSuccess:!0}}catch(_){return console.log("Error ",_),{error:!0,message:_}}},C=async e=>{let{server:t,token:a,base64:r,textKey:s,negativeKey:n,steps:o,width:i,height:c,strength:p,scale:l,seed:m,samples:g,samplerIndex:h,model:u,isControl:w,controlNets:y}=e;try{const e="".concat(t,"/img2img"),p=new Headers;p.append("Authorization","Bearer ".concat(a)),p.append("content-type","application/json"),p.append("accept","application/json");let _={extra:{enable_nsfw_detection:!1},request:{model_name:u||"anyhentai_20_31826.safetensors",image_base64:r,prompt:s,negative_prompt:n,width:i,height:c,image_num:g||1,steps:o,seed:m||-1,guidance_scale:l,sampler_name:h||"Euler a",strength:1}};if(w){const e=[];for(let t=0;t<y.length;t++)e.push({...y[t],image_base64:r});_.request={..._.request,controlnet:{units:e}}}const f=await fetch(e,{method:"POST",headers:p,body:JSON.stringify(_)});if(200!==f.status){const e=await f.text();return console.log("Error ",e),{error:!0,message:e}}const b=(await f.json()).task_id;let E,x="",A=0;for(;A<3600;){const e=await fetch("".concat(t,"/task-result?task_id=").concat(b),{method:"GET",headers:p});if(E=await e.json(),"TASK_STATUS_SUCCEED"===E.task.status&&E.images.length){x=E.images[0].image_url;break}await(0,d.yy)(1e3),A++}return{data:x,isSuccess:!0}}catch(_){return console.log("Error ",_),{error:!0,message:_}}},H=async e=>{let{server:t,token:a,image:r,isRemoveBg:s}=e;try{const e="".concat(t,"/face-to-sticker"),n={image_url:r.url,prompt:"high quality",image_size:"square_hd",num_inference_steps:20,guidance_scale:4.5,instant_id_strength:.85,ip_adapter_weight:.2,ip_adapter_noise:.5,upscale_steps:10,enable_safety_checker:!1},o=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:a},body:JSON.stringify(n)});if(200!==o.status)return console.log("Error ",await o.text()),{error:!0};const i=await o.json();return i.images.length?(console.log("_response ",i),{data:s?i.sticker_image_background_removed.url:i.sticker_image.url,isSuccess:!0}):{error:!0}}catch(n){return console.log("Error requestFaceSticker ",n),{error:!0}}},R=async e=>{let{server:t,token:a,baseImage:r,swapImage:s}=e;try{const e="".concat(t,"/face-swap"),n={base_image_url:r.url,swap_image_url:s.url},o=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:a},body:JSON.stringify(n)});if(200!==o.status)return{error:!0};const i=await o.json();return i.image?{data:i.image.url,isSuccess:!0}:{error:!0}}catch(n){return{error:!0}}}},7385:(e,t,a)=>{a.d(t,{RZ:()=>s,Sk:()=>n,hs:()=>o,nJ:()=>i,yy:()=>r});const r=e=>new Promise((t=>setTimeout(t,e))),s=e=>{let{min:t,max:a}=e;return Math.floor(Math.random()*(a-t+1))+t},n=e=>new Promise(((t,a)=>{const r=new FileReader;r.onloadend=()=>t(r.result),r.readAsDataURL(e)})),o=async e=>{const t=await fetch(e),a=await t.blob();return new Promise(((e,t)=>{const r=new FileReader;r.readAsDataURL(a),r.onloadend=()=>{const t=r.result;e(t)},r.onerror=t}))},i=async e=>{let{imageSrc:t,rate:a,iw:r,ih:s}=e,n=0,o=0,i=0,p=0;s>r||s===r&&a>1?(n=0,o=s/2-r/(2*a),i=r,p=r/a,o<0&&(n=r/2-s*a/2,o=0,i=s*a,p=s)):(n=r/2-s*a/2,o=0,i=s*a,p=s,n<0&&(n=0,o=s/2-r/(2*a),i=r,p=r/a));const d=await(l=t,new Promise(((e,t)=>{const a=new Image;a.addEventListener("load",(()=>e(a))),a.addEventListener("error",(e=>t(e))),a.setAttribute("crossOrigin","anonymous"),a.src=l})));var l;const m=document.createElement("canvas"),g=m.getContext("2d");m.width=i,m.height=p,g.drawImage(d,n,o,i,p,0,0,i,p);const h=m.toDataURL("image/jpeg",1);return{file:c(h,"img.png"),base64:h}},c=(e,t)=>{for(var a=e.split(","),r=a[0].match(/:(.*?);/)[1],s=atob(a[1]),n=s.length,o=new Uint8Array(n);n--;)o[n]=s.charCodeAt(n);return new File([o],t,{type:r})}}}]);